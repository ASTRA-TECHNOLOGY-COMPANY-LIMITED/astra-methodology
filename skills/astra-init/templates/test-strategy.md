# 테스트 전략

> 프로젝트의 테스트 범위, 전략, 기준을 정의합니다.
> 기능 스프린트에서 `docs/tests/test-cases/` 하위에 기능별 테스트 케이스 문서가 추가됩니다.

## 1. 테스트 레벨 정의

### 1.1 단위 테스트 (Unit Test)

- **범위**: 개별 함수, 메서드, 클래스 단위
- **목적**: 비즈니스 로직의 정확성 검증
- **대상**: 서비스 레이어, 유틸리티, 도메인 로직
- **제외**: 컨트롤러, 리포지토리 (통합 테스트에서 다룸)

### 1.2 통합 테스트 (Integration Test)

- **범위**: API 엔드포인트, DB 연동, 외부 서비스 연동
- **목적**: 모듈 간 상호작용 검증
- **대상**: REST API, 데이터베이스 CRUD, 인증/인가 흐름

### 1.3 E2E 테스트 (End-to-End Test)

- **범위**: 사용자 시나리오 전체 흐름
- **목적**: 실제 사용자 관점에서의 기능 동작 확인
- **대상**: 핵심 비즈니스 시나리오 (회원가입→로그인→주문→결제)

## 2. 테스트 커버리지 목표

| 레벨 | 대상 | 목표 커버리지 |
|------|------|-------------|
| 단위 테스트 | 서비스 레이어 | 70%+ |
| 단위 테스트 | 핵심 비즈니스 로직 | 90%+ |
| 통합 테스트 | API 엔드포인트 | 주요 경로 100% |
| E2E 테스트 | 핵심 시나리오 | 주요 시나리오 100% |

## 3. 테스트 네이밍 규칙

**Given-When-Then 패턴**을 따릅니다:

```
# Java/Kotlin
@Test
void given_유효한사용자정보_when_회원가입요청_then_성공응답반환()

# TypeScript/JavaScript
describe('회원가입', () => {
  it('유효한 사용자 정보로 요청하면 성공 응답을 반환한다', () => {})
})

# Python
def test_given_valid_user_info_when_signup_then_returns_success():
```

## 4. 테스트 환경 구성

### 4.1 테스트 DB

- 테스트 전용 데이터베이스 사용 (운영 DB와 분리)
- 테스트 실행 전 스키마 초기화
- `docs/database/database-design.md`의 DDL 기반 스키마 생성

### 4.2 목 서버 (Mock Server)

- 외부 API 연동은 목 서버로 대체
- PG사 API, SMS API, 이메일 API 등

### 4.3 테스트 데이터 관리

- **Fixture 패턴**: 정적 테스트 데이터 정의
- **Factory 패턴**: 동적 테스트 데이터 생성
- 테스트 간 데이터 격리 보장

## 5. 주요 모듈별 테스트 범위

### 5.1 인증 모듈

| 시나리오 | 테스트 레벨 | 우선순위 |
|---------|-----------|---------|
| 회원가입 (정상) | 단위 + 통합 | 높음 |
| 회원가입 (중복 이메일) | 단위 + 통합 | 높음 |
| 로그인 (정상) | 단위 + 통합 | 높음 |
| 로그인 (잘못된 비밀번호) | 단위 + 통합 | 높음 |
| 토큰 갱신 | 단위 + 통합 | 높음 |
| 토큰 만료 처리 | 단위 | 중간 |

### 5.2 결제 모듈

| 시나리오 | 테스트 레벨 | 우선순위 |
|---------|-----------|---------|
| 결제 성공 | 단위 + 통합 | 높음 |
| 결제 실패 (잔액 부족) | 단위 + 통합 | 높음 |
| 결제 재시도 | 단위 | 높음 |
| 환불 처리 | 단위 + 통합 | 높음 |

### 5.3 주문 모듈

| 시나리오 | 테스트 레벨 | 우선순위 |
|---------|-----------|---------|
| 주문 생성 | 단위 + 통합 | 높음 |
| 주문 취소 | 단위 + 통합 | 높음 |
| 주문 상태 변경 | 단위 | 중간 |

> **기능 스프린트에서 기능별 테스트 케이스 문서가 `docs/tests/test-cases/`에 추가됩니다.**
> 설계 문서(blueprint)의 기능 요구사항을 기반으로 테스트 케이스를 사전 정의하고,
> AI가 코드와 테스트를 동시에 생성할 때 이 문서를 참조합니다.

## 6. 자동화 범위

### 6.1 CI/CD 파이프라인

```
PR 생성 시:
  ├─ 단위 테스트 전체 실행
  ├─ 통합 테스트 전체 실행
  ├─ 코드 커버리지 리포트 생성
  └─ 커버리지 임계값 미달 시 PR 차단

main 브랜치 머지 시:
  ├─ E2E 테스트 실행
  └─ 테스트 결과 docs/tests/test-reports/에 기록
```

### 6.2 테스트 결과 보고

- 스프린트별 테스트 결과를 `docs/tests/test-reports/sprint-{N}-report.md`에 기록
- 모듈별 통과/실패 현황, 커버리지 요약, 발견된 이슈 포함

---

> **갱신 규칙**:
> 1. 새 모듈 추가 시 섹션 5에 테스트 범위를 추가합니다.
> 2. 스프린트 회고에서 테스트 전략 개선사항을 반영합니다.
